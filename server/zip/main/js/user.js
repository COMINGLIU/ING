!function(u,e){var m=document;function d(){this.welPage(),this.login(),this.controlNav(),this.openNav(),this.logo()}u.sessionStorage.setItem("userInfo",""),Object.defineProperty(d.prototype,"constructor",{enumerable:!1,value:d}),d.prototype={doEvent:{addEvent:function(e,t,o){e.addEventListener?e.addEventListener(t,o):ele.attachEvent?e.attachEvent("on"+t,o):e["on"+t]=o},delEvent:function(e,t,o){e.removeEventListener?e.removeEventListener(t,o):ele.dettachEvent?e.dettachEvent("on"+t,o):e["on"+t]=null},stop:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}},welPage:function(){var t=m.querySelector("#welcome i"),o=m.getElementById("welcome"),n=m.querySelector("#welcome .username"),l=m.getElementById("regitLog"),r=m.getElementsByClassName("login")[0],a={nickName:m.getElementsByName("nickName")[0],tel:m.getElementsByName("tel")[0],email:m.getElementsByName("email")[0],college:m.getElementsByName("college")[0],shopperName:m.getElementsByName("storeName")[0],shopperSlogan:m.getElementsByName("storeSlogan")[0]};this.getCookieModule(function(e){console.log(e),g=JSON.parse(e.get("user")),console.log(g),g?(console.log(a),n.innerHTML=g.userName,a.nickName.value=g.userName,a.tel.value=g.tel,a.email.value=g.email,a.college.value=g.schoolName,d.prototype.getAjaxModule(function(e){e({url:"/",data:{act:"getUserCenterInfo",userId:g.userId},method:"get",error:function(e){alert("error:"+e)},success:function(e){u.sessionStorage.setItem("userCenterInfo",e),e=JSON.parse(e),console.log(e),a.shopperName.value=e.myShopper.shopperName,a.shopperSlogan.value=e.myShopper.shopperDescribe,d.prototype.modEvent(),d.prototype.renderLikes(e),d.prototype.delLikes()}})})):n.innerHTML="hello",d.prototype.doEvent.addEvent(t,"click",function(){g=JSON.parse(e.get("user")),console.log(g),g?o.style.height="0":(l.style.display="block",r.style.display="block")})}),d.prototype.doEvent.addEvent(t,"mouseenter",function(){t.style.transform="translate(20px)"}),d.prototype.doEvent.addEvent(t,"mouseleave",function(){t.style.transform="translate(0)"})},login:function(){var o=m.getElementsByClassName("login")[0],n=m.getElementById("regitLog"),e=m.getElementById("login-form"),l={oTelEmail:e.querySelector("input[name='telEmail']"),oLoginPass:e.querySelector("input[name='pass']")},r=[];for(var t in l)!function(e){l[e].onchange=function(){"oTelEmail"==e&&0==/(^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,3}$)|(^1[3|4|5|8]\d{9}$)/.test(l[e].value)?(m.getElementById(e).innerHTML="格式错误",l[e].style.borderColor="red",-1==r.indexOf(e)&&r.push(e)):(m.getElementById(e).innerHTML="",l[e].style.borderColor="#ccc")}}(t);e.onsubmit=function(e){(e=e||u.e).preventDefault?e.preventDefault():e.returnValue=!1},console.log(n),d.prototype.doEvent.addEvent(n,"click",function(e){var t=(e=e||u.e).target||e.srcElement;switch(e.stopPropagation?e.stopPropagation():e.returnValue=!1,t.id){case"loginSubBtn":console.log(r),""!=l.oTelEmail.value&&""!=l.oLoginPass.value&&0==r.length&&d.prototype.getAjaxModule(function(e){e({url:"/",data:{act:"login",telEmail:l.oTelEmail.value,pass:l.oLoginPass.value},method:"post",error:function(e){console.log("error"+e)},success:function(e){e=JSON.parse(e),console.log(e);var t=e.user;"success"==e.status?(n.style.display="none",o.style.display="none",d.prototype.getCookieModule(function(e){e.set("user",JSON.stringify(t)),console.log(e.get("user"))}),m.querySelector("#welcome .username").innerHTML=t.userName):"fail"==e.status&&(m.getElementById("loginOk").innerHTML=e.msg)}})});break;case"cancelBtn":n.style.display="none",o.style.display="none"}})},controlNav:function(){m.querySelector("#userNav .mod");var t=m.getElementById("userNav"),o=(m.querySelector("#userNav .collects"),m.querySelector("#userNav .myStore"),m.querySelector("#content ul"));this.doEvent.addEvent(t,"click",function(e){switch((e=e||u.e).stopPropagation?e.stopPropagation():e.cancelBubble=!0,(e.target||e.srcElement).className){case"mod":o.style.transform="translate(0)",t.style.right="calc( -100% + 300px)",t.style.border="0";break;case"collects":o.style.transform="translate(-50%)",t.style.right="calc( 100% - 300px)",t.style.border="0";break;case"myStore":if(console.log(g),null==g.isSeller)confirm("您还没有注册书店，是否跳转到主页注册？")&&(u.location.href="index.html");else u.location.href="them1.html?storeId="+g.userId;break;case"toMyStoreCenter":if(console.log(g),null==g.isSeller)confirm("您还没有注册书店，是否跳转到首页注册？")&&(u.location.href="index.html");else u.location.href="addBook.html?uerId="+g.userId+"&userName="+g.userName}})},openNav:function(){var e=m.getElementById("header"),o=(m.getElementById("user-menu"),m.getElementById("user-menu")),n=m.getElementById("menuUl"),l=m.querySelector("#content>ul"),r=0;this.doEvent.addEvent(e,"click",function(e){var t=(e=e||u.e).target||e.srcElement;switch(console.log(t),t.id){case"user-menu":++r%2==1?(o.className="iconfont icon-guanbi",n.style.transform="translate(0)"):(o.className="iconfont icon-menu",n.style.transform="translate(100%)");break;case"resetInfo-li":l.style.transform="translate(0)",o.className="iconfont icon-menu",n.style.transform="translate(100%)",r++;break;case"collects-li":l.style.transform="translate(-50%)",o.className="iconfont icon-menu",n.style.transform="translate(100%)",r++;break;case"openStore-li":if(console.log(g),null==g.isSeller)confirm("您还没有注册书店，是否跳转到主页注册？")&&(u.location.href="index.html");else u.location.href="them1.html?storeId="+g.userId;break;case"openStoreCenter-li":if(console.log(g),null==g.isSeller)confirm("您还没有注册书店，是否跳转到首页注册？")&&(u.location.href="index.html");else u.location.href="addBook.html?uerId="+g.userId+"&userName="+g.userName}})},modEvent:function(){for(var e=m.querySelector(".reset"),s=(m.querySelector(".reset i"),m.querySelector(".reset button.yes")),i=m.querySelector(".reset button.no"),c=m.getElementById("infoModi").getElementsByTagName("input"),t=m.querySelector("#infoModi form"),o={},n=0,l=c.length;n<l;n++)o[c[n].name]=c[n].value;console.log(o),u.sessionStorage.setItem("userInfo",JSON.stringify(o)),this.doEvent.addEvent(t,"submit",function(e){(e=e||u.e).perventDefault?e.preventDefault():e.returnValue=!1}),this.doEvent.addEvent(e,"click",function(e){var t=(e=e||u.e).target||e.srcElement;switch(t.nodeName.toLowerCase()){case"i":s.style.display="inline",i.style.display="inline";for(var o=0,n=c.length;o<n;o++)"tel"!=c[o].name&&"email"!=c[o].name&&(c[o].readOnly=!1);break;case"button":switch(t.className){case"yes":d.prototype.getAjaxModule(function(e){e({url:"/",data:{act:"modifyUserInfo",userId:g.userId,nickName:c[0].value,tel:c[1].value,email:c[2].value,college:c[3].value,storeName:c[4].value,storeSlogan:c[5].value},method:"post",error:function(e){alert("error:"+e)},success:function(e){if("success"==(e=JSON.parse(e)).status){alert("更新成功");for(var t=0,o=c.length;t<o;t++)"tel"!=c[t].name&&"email"!=c[t].name&&(c[t].readOnly=!0);s.style.display="none",i.style.display="none"}else alert("更新失败"+e.msg)}})});break;case"no":var l=JSON.parse(u.sessionStorage.getItem("userInfo"));console.log(l);for(var r=0,a=c.length;r<a;r++)switch(c[r].readOnly=!0,c[r].name){case"nickName":c[r].value=l.nickName;break;case"tel":c[r].value=l.tel;break;case"email":c[r].value=l.email;break;case"college":c[r].value=l.college;break;case"storeName":c[r].value=l.storeName;break;case"storeSlogan":c[r].value=l.storeSlogan}s.style.display="none",i.style.display="none"}}})},renderLikes:function(e){for(var t=m.getElementsByClassName("booksUl")[0],o=m.getElementsByClassName("storeUl")[0],n=m.createDocumentFragment(),l=m.createDocumentFragment(),r=0,a=e.like_books.length;r<a;r++){(c=m.createElement("li")).innerHTML='<a href="detail.html?bookId='+e.like_books[r].bookId+'" target="blank"><div><img src="imgs/storeImg/'+e.like_books[r].bookSrc+'"></div></a><h3>'+e.like_books[r].bookName+'<i class="iconfont icon-lajixiang"></i></h3>',n.appendChild(c)}t.appendChild(n);for(var s=0,i=e.like_stores.length;s<i;s++){var c;(c=m.createElement("li")).innerHTML='<a href="them1.html?storeId='+e.like_stores[s].userId+'" target="blank"><div><img src="imgs/storeImg/'+e.like_stores[s].shopperImg+'"></div></a><h3>'+e.like_stores[s].shopperName+'<i class="iconfont icon-lajixiang"></i></h3>',l.appendChild(c)}o.appendChild(l)},delLikes:function(){var n=m.querySelectorAll(".booksUl .icon-lajixiang"),e=m.querySelectorAll(".booksUl a"),l=m.querySelector(".booksUl"),r=m.querySelectorAll(".storeUl .icon-lajixiang");aStoreHref=m.querySelectorAll(".storeUl a"),oStoreUl=m.querySelector(".storeUl");for(var t=0,o=n.length;t<o;t++)!function(t){var o=e[t].href.split("?")[1].split("=")[1];n[t].onclick=function(){confirm("确定取消收藏该书籍吗?")&&d.prototype.getAjaxModule(function(e){e({url:"/",data:{act:"cancelCollectBook",userId:g.userId,bookId:o},method:"get",error:function(e){alert("err:"+e)},success:function(e){e=JSON.parse(e),console.log(e),"success"==e.status?(d.prototype.getLikeInfo("已取消收藏"),l.removeChild(n[t].parentNode.parentNode)):d.prototype.getLikeInfo("取消收藏失败")}})})}}(t);for(var a=0,s=r.length;a<s;a++)!function(t){var o=aStoreHref[t].href.split("?")[1].split("=")[1];r[t].onclick=function(){confirm("确定取消收藏该书店吗？")&&d.prototype.getAjaxModule(function(e){e({url:"/",data:{act:"cancelCollectStore",userId:g.userId,storeId:o},method:"get",error:function(e){alert("err:"+e)},success:function(e){e=JSON.parse(e),console.log(e),"success"==e.status?(d.prototype.getLikeInfo("已取消收藏"),oStoreUl.removeChild(r[t].parentNode.parentNode)):d.prototype.getLikeInfo("取消收藏失败")}})})}}(a)},getLikeInfo:function(e){var t=m.getElementById("likeInfo");t.style.opacity="1",t.innerHTML=e;setTimeout(function(){t.style.opacity="0"},1e3)},logo:function(){m.getElementById("logo").onclick=function(){u.location.href="index.html"}},getCookieModule:function(t){seajs.use("cookie.js",function(e){t&&t(e)})},getAjaxModule:function(t){seajs.use("ajax.js",function(e){t&&t(e)})}};var g=new d}(window);