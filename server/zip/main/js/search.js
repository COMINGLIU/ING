!function(g,e){var n,d=document;function m(){this.init(),this.getHeaderModule(),this.getAjaxModule(),this.getAddStoreModule(),this.searchPulsBook(),this.controlCollectBox()}Object.defineProperty(m.prototype,"constructor",{enumerable:!1,value:m}),m.prototype={getHeaderModule:function(){seajs.use("header.js",function(n){var e,a,s,r,i,c,o,u;n.regitLogin(),n.scrollHeader(),e=d.getElementById("header"),a=d.getElementById("nav"),s=d.getElementById("searchBox"),r=s.getElementsByTagName("input")[0],i=d.getElementById("add-store"),c=d.getElementById("menu"),o=d.getElementById("keyword-search"),u=0,n.DoEvent.addEvent(e,"click",function(e){(e=e||g.e).stopPropagation?e.stopPropagation():e.cancelBubble=!0;var o=e.target||e.srcElement;switch(console.log(o),o.id){case"menu":++u%2!=0?(a.style.transform="translateX(0)",o.className="iconfont icon-pause"):(a.style.transform="translateX(100%)",o.className="iconfont icon-menu");break;case"userCenter":case"userCenterBtn":if("LOGIN"==d.getElementById("regitBtn").innerHTML){var t=confirm("登录后才能访问个人中心，登录吗?");t&&(d.getElementById("regitLog").style.display="block",d.getElementsByClassName("login")[0].style.display="block")}else g.location.href="user.html";break;case"searchBtnLi":case"searchBtn":s.style.height="138px","0px"==n.getStyle(a,"right")&&(a.style.transform="translateX(100%)",u++),r.focus(),d.getElementById("menu").className="iconfont icon-menu";break;case"searchCloseBtn":s.style.height="0";break;case"addStoreBtn":if("LOGIN"==d.getElementById("regitBtn").innerHTML){var t=confirm("需要登录后才能添加属于您自己的书店，登录吗？");t&&(d.getElementById("regitLog").style.display="block",d.getElementsByClassName("login")[0].style.display="block")}else if(null!=JSON.parse(m.prototype.getCookieModule().get("user")).isSeller){var l=JSON.parse(m.prototype.getCookieModule().get("user"));g.location.href="them1.html?storeId="+l.userId}else{var t=confirm("您还没有注册书店，是否注册?");t&&(i.style.height="100%","none"==m.prototype.getStyle(c,"display")&&u++)}break;case"openStoreBtn":if("LOGIN"==d.getElementById("regitBtn").innerHTML){var t=confirm("需要登录后才能进入您的书店中心，登录吗？");t&&(d.getElementById("regitLog").style.display="block",d.getElementsByClassName("login")[0].style.display="block")}else if(null!=JSON.parse(m.prototype.getCookieModule().get("user")).isSeller){var l=JSON.parse(m.prototype.getCookieModule().get("user"));g.location.href="them1.html?storeId="+l.userId}else{var t=confirm("您还没有注册书店，是否注册?");t&&(i.style.height="100%","none"==m.prototype.getStyle(c,"display")&&u++)}}}),n.DoEvent.addEvent(o,"click",function(){s.style.height="138px","0px"==n.getStyle(a,"right")&&(a.style.transform="translateX(100%)",u++),r.focus(),d.getElementById("menu").className="iconfont icon-menu"})})},init:function(){for(var e=d.querySelectorAll("#search-keywors li"),o={bookName:e[0],bookPublic:e[1],bookAddr:e[2]},t={bookName:"",bookPublic:"",bookAddr:""},l=decodeURI(g.location.search).split("?")[1].split("&"),n=0,a=l.length-1;n<a;n++)t[l[n].split("=")[0]]=l[n].split("=")[1],o[l[n].split("=")[0]].innerHTML=l[n].split("=")[1];this.getAjaxModule(function(e){e({url:"/",data:{act:"searchBook",bookName:t.bookName,bookPublic:t.bookPublic,bookCollege:t.bookAddr},method:"get",error:function(e){alert("error:"+e)},success:function(e){e=JSON.parse(e);console.log(e),"success"==e.status?(data=e.data,console.log(data),""==data.toString()?m.prototype.getNobookInfo():m.prototype.renderData(data)):console.log("err:"+e.msg)}})})},renderData:function(e){var o=d.getElementsByClassName("books")[0],t=o.getElementsByTagName("li");if(frag=d.createDocumentFragment(),0<t.length){console.log(t);var l=d.querySelectorAll("#content .books>li");console.log(l);for(var n=0,a=l.length;n<a;n++)o.removeChild(l[n])}var s=0;for(a=e.length;s<a;s++){var r=d.createElement("li");r.innerHTML='<div><img src="imgs/storeImg/'+e[s].bookSrc+'" alt="book"></div><i class="iconfont icon-heart-fill"></i><a href="detail.html?bookId='+e[s].bookId+'" target="blank"><p class="price">￥<span>'+e[s].bookPrice+"</span></p><h3>"+e[s].bookName+'</h3><p class="public">'+e[s].bookPublic+'</p><p class="addr"><i class="iconfont icon-location"></i><span>'+e[s].schoolName+"</span></p></a>",frag.appendChild(r)}o.appendChild(frag),m.prototype.collectBook()},getAddStoreModule:function(){seajs.use("addStore.js",function(e){})},searchPulsBook:function(){var o={oBookName:d.getElementsByName("bookName")[0],oPublic:d.getElementsByName("public")[0],oCollege:d.getElementsByName("college")[0]},e=d.querySelectorAll("#search-keywors li"),t={bookName:e[0],bookPublic:e[1],bookAddr:e[2]};for(var l in o)o[l].onchange=function(){var e="?bookName="+o.oBookName.value+"&bookPublic="+o.oPublic.value+"&bookCollege="+o.oCollege.value;history.replaceState(null,"修改",e),""==o.oBookName.value&&""==o.oPublic.value&&""==o.oCollege.value||m.prototype.getAjaxModule(function(e){e({url:"/",data:{act:"searchBook",bookName:o.oBookName.value,bookPublic:o.oPublic.value,bookCollege:o.oCollege.value},method:"get",error:function(e){alert("err:"+e)},success:function(e){e=JSON.parse(e),console.log(e),"success"==e.status?(data=e.data,""==data.toString()?m.prototype.getNobookInfo():m.prototype.renderData(data)):console.log("err:"+e.msg)}})}),t.bookName.innerHTML=o.oBookName.value,t.bookPublic.innerHTML=o.oPublic.value,t.bookAddr.innerHTML=o.oCollege.value}},collectBook:function(){for(var l=d.getElementsByClassName("icon-heart-fill"),e=d.querySelectorAll(".books a"),o=0,t=l.length;o<t;o++)!function(o){var t=e[o].href.split("?")[1].split("=")[1];l[o].onclick=function(){m.prototype.getCookieModule(function(e){e.get("user")?(n=JSON.parse(e.get("user")),m.prototype.getAjaxModule(function(e){e({url:"/",data:{act:"collectBook",userId:n.userId,bookId:t},method:"get",error:function(e){console.log("err:"+e)},success:function(e){e=JSON.parse(e),console.log(e),"success"==e.status?(l[o].style.color="#900",m.prototype.getLikeInfo()):alert("收藏失败")}})})):confirm("登录后才能保存收藏的书籍，登录吗？")&&(d.getElementById("regitLog").style.display="block",d.getElementsByClassName("login")[0].style.display="block")})}}(o)},controlCollectBox:function(){seajs.use("collects.js",function(e){e()})},getLikeInfo:function(e){var o=d.getElementById("likeInfo");"yes"==e?o.innerHTML="已收藏":"no"==e&&(o.innerHTML="已取消收藏"),o.style.opacity="1";setTimeout(function(){o.style.opacity="0"},1e3)},getNobookInfo:function(){var e=d.getElementById("noBookInfo");e.style.opacity="1";setTimeout(function(){e.style.opacity="0"},1500)},getAjaxModule:function(o){seajs.use("ajax.js",function(e){o&&o(e)})},getCookieModule:function(o){seajs.use("cookie.js",function(e){o&&o(e)})},getStyle:function(e,o){return getComputedStyle?getComputedStyle(e)[o]:e.currentStyle[o]}};new m}(window);